---
layout: post
title: redux
date: 2018-6-1
categories: react
tags: [redux]
description: 边学边记录。
---

### Flux
[http://www.ruanyifeng.com/blog/2016/01/flux.html](http://www.ruanyifeng.com/blog/2016/01/flux.html)
> 单向数据流;Flux 是一种架构思想，专门解决软件的结构问题。它跟MVC 架构是同一类东西，但是更加简单和清晰 
 Flux将一个应用分成四个部分
- View： 视图层
- Action（动作）：视图层发出的消息（比如mouseClick）
- Dispatcher（派发器）：用来接收Actions、执行回调函数
- Store（数据层）：用来存放应用的状态，一旦发生变动，就提醒Views要更新页面

![图片]({{ site.baseurl }}/img/post/flux-diagram-white-background.png)

### Redux
[http://www.redux.org.cn/](http://www.redux.org.cn/)
> 状态管理容器；Flux 架构的概念的实现；应用程序的数据称为状态
View -> Action -> Dispatcher -> Store	

- 存放应用程序状态的容器
- 一种把 action 分发到状态修改器的机制，也就是 reducer 函数
- 监听状态变化的机制

---
三大原则

- 单一数据源 - 整个应用的 state 被储存在一棵 object tree 中，并且这个 object tree 只存在于唯一一个 store 中
- State 是只读的 - 唯一改变 state 的方法就是触发 action
- 使用纯函数来执行修改 - 为了描述 action 如何改变 state tree ，你需要编写 reducers

`state`
{% highlight Perl %}
{
    todos: [{
        text: 'Eat food',
        completed: true
    }, {
        text: 'Exercise',
        completed: false
    }],
    visibilityFilter: 'SHOW_COMPLETED'
}
{% endhighlight %}

> 想更新 state 中的数据，你需要发起一个 action
`action`
{% highlight Perl %}
{ type: 'ADD_TODO', text: 'Go to swimming pool' }
{ type: 'TOGGLE_TODO', index: 1 }
{ type: 'SET_VISIBILITY_FILTER', filter: 'SHOW_ALL' }

// 触发action
store.dispatch({
    type: 'COMPLETE_TODO',
    index: 1
})
{% endhighlight %}

> 把 action 和 state 串起来，开发一些函数，只是一个接收 state 和 action，并返回新的 state 的函数
`reducer`
{% highlight Perl %}
function todos(state = [], action) {
    switch (action.type) {
    case 'ADD_TODO':
        return state.concat([{ text: action.text, completed: false }]);
    case 'TOGGLE_TODO':
        return state.map((todo, index) => action.index === index ? { text: todo.text, completed: !todo.completed } : todo
    )
    default:
        return state;
}}
{% endhighlight %}

### Redux-saga
[https://redux-saga-in-chinese.js.org/](https://redux-saga-in-chinese.js.org/)
> 用于管理 action，处理异步逻辑。redux-saga 是一个 redux 的中间件

![图片]({{ site.baseurl }}/img/post/React+Redux.png)
React+Redux Cycle(来源：https://www.youtube.com/watch?v=1QI-UE3-0PU)